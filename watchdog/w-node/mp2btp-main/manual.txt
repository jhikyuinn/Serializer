* Application Compile 

go build push_child_equic.go; go build push_root_equic.go


* fectun 실행 방법 

- 아래와 같은 Enhanced QUIC App과 fectun 실행 상황을 가정 

[Sender]$ ./fectun -a 203.252.112.32:6000 -u 203.252.112.32:5000 -s 203.252.112.32:6001 -d 203.252.112.31:6001           # Sender's Application Port=4000
[Receiver]$ ./fectun -r -a 203.252.112.31:6000 -u 203.252.112.31:4000 -s 203.252.112.31:6001 -d 203.252.112.32:6001      # Receiveer's QUIC Port=5000, Fectun Port=7000


- Packet forwarding 활성화
sudo sysctl -w net.ipv4.ip_forward=1   

- iptable 추가 

sudo iptables -t nat -A PREROUTING -p udp --dport 5000 -d 203.252.112.31 -j DNAT --to-destination 203.252.112.32:6000
sudo iptables -t nat -A OUTPUT -p udp --dport 5000 -d 203.252.112.31 -j DNAT --to-destination 203.252.112.32:6000


sudo iptables -t nat -A PREROUTING -s 127.0.0.1 -p udp --sport 4000 --dport 5000 -j REDIRECT --to-port 6000; sudo iptables -t nat -A OUTPUT -s 127.0.0.1 -p udp --sport 4000 --dport 5000 -j REDIRECT --to-port 6000;
sudo iptables -t nat -A PREROUTING -s 127.0.0.1 -p udp --sport 5000 --dport 4000 -j REDIRECT --to-port 7000; sudo iptables -t nat -A OUTPUT -s 127.0.0.1 -p udp --sport 5000 --dport 4000 -j REDIRECT --to-port 7000;

(sudo iptables -t nat -A PREROUTING -s 127.0.0.1 -p udp --dport 9000 -j REDIRECT --to 8000; sudo iptables -t nat -A OUTPUT -s 127.0.0.1 -p udp --dport 9000 -j REDIRECT --to 8000)
(sudo iptables -t nat -A PREROUTING -s 127.0.0.1 -p udp --sport 8000 --dport 9000 -j REDIRECT --to-port 8001; sudo iptables -t nat -A OUTPUT -s 127.0.0.1 -p udp --sport 8000 --dport 9000 -j REDIRECT --to-port 8001)
(iptables -A PREROUTING -t nat -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8051)

sudo iptables -t nat -A PREROUTING -p udp --dport 5000 -d 203.252.112.31 -j DNAT --to-destination 203.252.112.32:6000


- iptable 삭제 
sudo iptables -t nat -D PREROUTING -s 127.0.0.1 -p udp --sport 4000 --dport 5000 -j REDIRECT --to-port 6000; sudo iptables -t nat -D OUTPUT -s 127.0.0.1 -p udp --sport 4000 --dport 5000 -j REDIRECT --to-port 6000

sudo iptables -t nat -D PREROUTING -s 127.0.0.1 -p udp --dport 5000 -j REDIRECT --to 6000; sudo iptables -t nat -D OUTPUT -s 127.0.0.1 -p udp --dport 5000 -j REDIRECT --to 6000
(sudo iptables -t nat -D PREROUTING -s 127.0.0.1 -p udp --sport 8000 --dport 9000 -j REDIRECT --to-port 8001; sudo iptables -t nat -D OUTPUT -s 127.0.0.1 -p udp --sport 8000 --dport 9000 -j REDIRECT --to-port 8001)

- iptable 리스트 확인
sudo iptables -t nat -L



* QUIC을 위한 UDP Socket Buffer 크기 증가 
sysctl -w net.core.rmem_max=2500000; sysctl -w net.core.wmem_max=2500000



* Performance Profiling 
gprof fectun gmon.out > result.txt



* TC 설정 
sudo tc qdisc del dev lo root
sudo tc qdisc add dev lo root handle 1:0 netem delay 15ms loss 0.8%



* Multipath setup 
sudo ip rule add from [ip address] table [number]
sudo ip route add [network address]/[subnet mask] dev [NIC name] scope link table [number]
sudo ip route add default via [gateway address] dev [NIC name] table [number]


@32 server

sudo ip rule add from 203.252.112.32 table 1
sudo ip route add 203.252.112.0/24 dev eno8303 scope link table 1
sudo ip route add default via 203.252.112.1 dev eno8303 table 1

sudo ip rule add from 192.168.10.3 table 2
sudo ip route add 192.168.10.0/24 dev eno8403 scope link table 2
sudo ip route add default via 192.168.10.1 dev eno8403 table 2